# UML Диаграммы для EduPlatform

## 1. ER-диаграмма (Entity-Relationship Diagram)

```mermaid
erDiagram
    Пользователь ||--o{ ЗаписьНаКурс : "имеет"
    Пользователь ||--o{ ОтзывОКурсе : "пишет"
    Пользователь ||--o{ ИзбранныйКурс : "добавляет"
    Пользователь ||--o{ ИзбранныйВебинар : "добавляет"
    Пользователь ||--o{ Сертификат : "получает"
    
    Курс ||--o{ Урок : "содержит"
    Курс ||--o{ ЗаписьНаКурс : "имеет"
    Курс ||--o{ ОтзывОКурсе : "имеет"
    Курс ||--o{ ИзбранныйКурс : "в избранном"
    
    ЗаписьНаКурс ||--o{ ЗавершениеУрока : "отслеживает"
    ЗаписьНаКурс ||--|| Сертификат : "генерирует"
    
    Урок ||--o{ ЗавершениеУрока : "завершается"
    
    Вебинар ||--o{ ИзбранныйВебинар : "в избранном"
    
    Пользователь {
        string идентификатор PK
        string имя
        string email UK
        string пароль
        string аватар
        string[] интересы
        boolean прошелТест
        enum роль
        datetime датаСоздания
        datetime датаОбновления
    }
    
    Курс {
        string идентификатор PK
        string название
        string описание
        string полноеОписание
        string преподаватель
        string длительность
        int студентов
        float рейтинг
        string категория
        float цена
        string изображение
        datetime датаСоздания
        datetime датаОбновления
    }
    
    Урок {
        string идентификатор PK
        string идентификаторКурса FK
        string название
        string длительность
        string содержание
        int порядок
        datetime датаСоздания
    }
    
    ЗаписьНаКурс {
        string идентификатор PK
        string идентификаторПользователя FK
        string идентификаторКурса FK
        float прогресс
        datetime датаСоздания
        datetime датаОбновления
    }
    
    ЗавершениеУрока {
        string идентификатор PK
        string идентификаторЗаписи FK
        string идентификаторУрока FK
        datetime датаЗавершения
    }
    
    Сертификат {
        string идентификатор PK
        string идентификаторЗаписи FK
        string идентификаторПользователя FK
        string идентификаторКурса FK
        string номерСертификата
        datetime датаВыдачи
    }
    
    ОтзывОКурсе {
        string идентификатор PK
        string идентификаторКурса FK
        string идентификаторПользователя FK
        int рейтинг
        string текст
        datetime датаСоздания
        datetime датаОбновления
    }
    
    Вебинар {
        string идентификатор PK
        string название
        string описание
        string полноеОписание
        string преподаватель
        string биографияПреподавателя
        datetime дата
        string длительность
        int участников
        boolean вЭфире
        string[] темы
        string категория
        datetime датаСоздания
        datetime датаОбновления
    }
    
    ИзбранныйКурс {
        string идентификатор PK
        string идентификаторПользователя FK
        string идентификаторКурса FK
        datetime датаСоздания
    }
    
    ИзбранныйВебинар {
        string идентификатор PK
        string идентификаторПользователя FK
        string идентификаторВебинара FK
        datetime датаСоздания
    }
```

## 2. Диаграмма классов (Class Diagram)

```mermaid
classDiagram
    class Пользователь {
        +String идентификатор
        +String имя
        +String email
        +String пароль
        +String аватар
        +String[] интересы
        +Boolean прошелТест
        +Роль роль
        +DateTime датаСоздания
        +DateTime датаОбновления
        +войти()
        +зарегистрироваться()
        +выйти()
    }
    
    class Курс {
        +String идентификатор
        +String название
        +String описание
        +String полноеОписание
        +String преподаватель
        +String длительность
        +Int студентов
        +Float рейтинг
        +String категория
        +Float цена
        +String изображение
        +DateTime датаСоздания
        +DateTime датаОбновления
        +добавитьУрок()
        +обновитьУрок()
        +удалитьУрок()
        +добавитьОтзыв()
    }
    
    class Урок {
        +String идентификатор
        +String идентификаторКурса
        +String название
        +String длительность
        +String содержание
        +Int порядок
        +DateTime датаСоздания
        +завершить()
    }
    
    class ЗаписьНаКурс {
        +String идентификатор
        +String идентификаторПользователя
        +String идентификаторКурса
        +Float прогресс
        +DateTime датаСоздания
        +DateTime датаОбновления
        +рассчитатьПрогресс()
        +завершитьУрок()
        +сгенерироватьСертификат()
    }
    
    class ЗавершениеУрока {
        +String идентификатор
        +String идентификаторЗаписи
        +String идентификаторУрока
        +DateTime датаЗавершения
    }
    
    class Сертификат {
        +String идентификатор
        +String идентификаторЗаписи
        +String идентификаторПользователя
        +String идентификаторКурса
        +String номерСертификата
        +DateTime датаВыдачи
        +сгенерироватьНомер()
        +скачать()
    }
    
    class ОтзывОКурсе {
        +String идентификатор
        +String идентификаторКурса
        +String идентификаторПользователя
        +Int рейтинг
        +String текст
        +DateTime датаСоздания
        +DateTime датаОбновления
    }
    
    class Вебинар {
        +String идентификатор
        +String название
        +String описание
        +String полноеОписание
        +String преподаватель
        +String биографияПреподавателя
        +DateTime дата
        +String длительность
        +Int участников
        +Boolean вЭфире
        +String[] темы
        +String категория
        +DateTime датаСоздания
        +DateTime датаОбновления
    }
    
    Пользователь "1" --> "*" ЗаписьНаКурс : записывается
    Пользователь "1" --> "*" ОтзывОКурсе : пишет
    Пользователь "1" --> "*" Сертификат : получает
    Курс "1" --> "*" Урок : содержит
    Курс "1" --> "*" ЗаписьНаКурс : имеет
    Курс "1" --> "*" ОтзывОКурсе : имеет
    ЗаписьНаКурс "1" --> "*" ЗавершениеУрока : отслеживает
    ЗаписьНаКурс "1" --> "0..1" Сертификат : генерирует
    Урок "1" --> "*" ЗавершениеУрока : завершается_в
```

## 3. Диаграмма компонентов (Component Diagram)

```mermaid
graph TB
    subgraph "Фронтенд (Next.js)"
        A[Страницы]
        B[Компоненты]
        C[Контексты]
        D[API Маршруты]
    end
    
    subgraph "Контексты"
        C1[КонтекстАвторизации]
        C2[КонтекстКурсов]
        C3[КонтекстЗаписей]
        C4[КонтекстИзбранного]
        C5[КонтекстВебинаров]
    end
    
    subgraph "Слой API"
        D1[API Авторизация]
        D2[API Курсы]
        D3[API Записи]
        D4[API Сертификаты]
        D5[API Вебинары]
        D6[API Избранное]
        D7[API Администрирование]
    end
    
    subgraph "Бизнес-логика"
        E1[СервисАвторизации]
        E2[СервисКурсов]
        E3[СервисЗаписей]
        E4[СервисСертификатов]
    end
    
    subgraph "Слой данных"
        F[Prisma ORM]
        G[(База данных PostgreSQL)]
    end
    
    A --> B
    A --> C
    C --> C1
    C --> C2
    C --> C3
    C --> C4
    C --> C5
    C --> D
    D --> D1
    D --> D2
    D --> D3
    D --> D4
    D --> D5
    D --> D6
    D --> D7
    D1 --> E1
    D2 --> E2
    D3 --> E3
    D4 --> E4
    E1 --> F
    E2 --> F
    E3 --> F
    E4 --> F
    F --> G
```

## 4. Диаграмма последовательности - Запись на курс

```mermaid
sequenceDiagram
    participant П as Пользователь (Браузер)
    participant СК as СтраницаКурса
    participant КЗ as КонтекстЗаписей
    participant API as API Записи
    participant БД as БазаДанных
    participant КК as КонтекстКурсов
    
    П->>СК: Нажимает "Записаться на курс"
    СК->>КЗ: обработатьЗапись()
    КЗ->>API: POST записи
    API->>БД: Проверка существующей записи
    БД-->>API: Результат проверки
    alt Запись не существует
        API->>БД: Создание ЗаписиНаКурс
        API->>БД: Увеличение счетчика студентов
        БД-->>API: ЗаписьНаКурс создана
        API-->>КЗ: Успешный ответ
        КЗ->>КЗ: получитьЗаписи()
        КЗ->>КК: обновитьКурсы()
        КЗ-->>СК: Обновление состояния
        СК-->>П: Отображение статуса "Записан"
    else Запись уже существует
        API-->>КЗ: Ошибка "Уже записан"
        КЗ-->>СК: Сообщение об ошибке
        СК-->>П: Показ ошибки
    end
```

## 5. Диаграмма последовательности - Завершение урока и получение сертификата

```mermaid
sequenceDiagram
    participant П as Пользователь
    participant СУ as СтраницаУрока
    participant КЗ as КонтекстЗаписей
    participant API as API ЗавершениеУрока
    participant БД as БазаДанных
    
    П->>СУ: Завершает урок
    СУ->>КЗ: завершитьУрок()
    КЗ->>API: POST завершить урок
    API->>БД: Создание ЗавершенияУрока
    API->>БД: Подсчет завершенных уроков
    API->>БД: Обновление прогресса в ЗаписиНаКурс
    
    alt прогресс >= 100%
        API->>БД: Проверка существования Сертификата
        alt Сертификат не существует
            API->>БД: Создание Сертификата
            API->>БД: Генерация номераСертификата
            БД-->>API: Сертификат создан
        end
        API-->>КЗ: Ответ с Сертификатом
        КЗ->>КЗ: получитьЗаписи()
        КЗ-->>СУ: Обновление состояния
        СУ-->>П: Уведомление о получении сертификата
    else прогресс < 100%
        API-->>КЗ: Ответ без Сертификата
        КЗ-->>СУ: Обновление прогресса
        СУ-->>П: Отображение обновленного прогресса
    end
```

## 6. Диаграмма состояний - Запись на курс

```mermaid
stateDiagram-v2
    [*] --> НеЗаписан: Пользователь не записан
    
    НеЗаписан --> Записывается: Нажатие "Записаться"
    Записывается --> Записан: Успешная запись
    Записывается --> НеЗаписан: Ошибка записи
    
    Записан --> ВПроцессе: Начало прохождения
    ВПроцессе --> УрокЗавершен: Завершение урока
    УрокЗавершен --> ВПроцессе: Продолжение курса
    УрокЗавершен --> Завершен: Все уроки завершены
    
    Завершен --> СертификатСгенерирован: Генерация сертификата
    СертификатСгенерирован --> [*]
    
    Записан --> Отписан: Отписка от курса
    ВПроцессе --> Отписан: Отписка от курса
    Отписан --> [*]
```

## 7. Диаграмма вариантов использования (Use Case Diagram)

```mermaid
graph TB
    subgraph "Актеры"
        Студент[Студент]
        Преподаватель[Преподаватель]
        Администратор[Администратор]
    end
    
    subgraph "Основные функции"
        ВУ1[Регистрация/Вход]
        ВУ2[Просмотр курсов]
        ВУ3[Запись на курс]
        ВУ4[Прохождение уроков]
        ВУ5[Получение сертификата]
        ВУ6[Просмотр вебинаров]
        ВУ7[Добавление в избранное]
        ВУ8[Оставление отзывов]
        ВУ9[Создание курса]
        ВУ10[Управление уроками]
        ВУ11[Управление пользователями]
        ВУ12[Просмотр статистики]
    end
    
    Студент --> ВУ1
    Студент --> ВУ2
    Студент --> ВУ3
    Студент --> ВУ4
    Студент --> ВУ5
    Студент --> ВУ6
    Студент --> ВУ7
    Студент --> ВУ8
    
    Преподаватель --> ВУ1
    Преподаватель --> ВУ2
    Преподаватель --> ВУ9
    Преподаватель --> ВУ10
    Преподаватель --> ВУ8
    
    Администратор --> ВУ1
    Администратор --> ВУ2
    Администратор --> ВУ9
    Администратор --> ВУ10
    Администратор --> ВУ11
    Администратор --> ВУ12
```

## 8. Диаграмма развертывания (Deployment Diagram)

```mermaid
graph TB
    subgraph "Клиент"
        Браузер[Веб-браузер]
    end
    
    subgraph "Сервер фронтенда"
        NextJS[Приложение Next.js]
        Статика[Статические файлы]
    end
    
    subgraph "Backend API"
        API[API Маршруты]
        Prisma[Prisma Client]
    end
    
    subgraph "Сервер базы данных"
        PostgreSQL[(База данных PostgreSQL)]
    end
    
    Браузер --> NextJS
    Браузер --> Статика
    NextJS --> API
    API --> Prisma
    Prisma --> PostgreSQL
```

## Описание диаграмм

### 1. ER-диаграмма
Показывает структуру базы данных, связи между таблицами и основные атрибуты каждой сущности.

### 2. Диаграмма классов
Отображает основные классы системы, их атрибуты и методы, а также отношения между классами.

### 3. Диаграмма компонентов
Демонстрирует архитектуру приложения, разделение на слои (Фронтенд, API, Бизнес-логика, Слой данных).

### 4. Диаграмма последовательности - Запись на курс
Показывает пошаговый процесс записи пользователя на курс с взаимодействием между компонентами.

### 5. Диаграмма последовательности - Завершение урока
Иллюстрирует процесс завершения урока, обновления прогресса и автоматической генерации сертификата при достижении 100%.

### 6. Диаграмма состояний
Отображает жизненный цикл записи на курс от момента записи до получения сертификата.

### 7. Диаграмма вариантов использования
Показывает основные функции системы и роли пользователей, которые могут их выполнять.

### 8. Диаграмма развертывания
Демонстрирует физическую архитектуру системы и взаимодействие между компонентами на уровне инфраструктуры.
